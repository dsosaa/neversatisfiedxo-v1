{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block title %}Trailer Dashboard{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <style>
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        text-align: center;
    }
    .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #0073aa;
        margin-bottom: 5px;
    }
    .stat-label {
        color: #666;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .progress-bar {
        width: 100%;
        height: 8px;
        background-color: #e0e0e0;
        border-radius: 4px;
        margin-top: 10px;
        overflow: hidden;
    }
    .progress-fill {
        height: 100%;
        background-color: #28a745;
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    .recent-uploads {
        margin-top: 30px;
    }
    .upload-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
    }
    .upload-item:last-child {
        border-bottom: none;
    }
    .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
    }
    .status-complete { background-color: #d4edda; color: #155724; }
    .status-processing { background-color: #fff3cd; color: #856404; }
    .status-pending { background-color: #cce7f0; color: #055160; }
    .status-error { background-color: #f8d7da; color: #721c24; }
    .status-distribution {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    .status-item {
        text-align: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
    }
    </style>
{% endblock %}

{% block content %}
<h1>Trailer Dashboard</h1>

<div class="dashboard-stats">
    <div class="stat-card">
        <div class="stat-number">{{ total_trailers }}</div>
        <div class="stat-label">Total Trailers</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">{{ completed_trailers }}</div>
        <div class="stat-label">Completed</div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ completion_rate }}%"></div>
        </div>
        <small>{{ completion_rate|floatformat:1 }}% completion rate</small>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">{{ featured_trailers }}</div>
        <div class="stat-label">Featured</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">{{ premium_trailers }}</div>
        <div class="stat-label">Premium</div>
    </div>
</div>

<div class="module">
    <h2>Upload Status Distribution</h2>
    <div class="status-distribution">
        {% for status, count in status_counts.items %}
        <div class="status-item">
            <div class="stat-number" style="font-size: 1.8em;">{{ count }}</div>
            <div class="stat-label">{{ status }}</div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="module recent-uploads">
    <h2>Recent Uploads</h2>
    {% if recent_trailers %}
    <div>
        {% for trailer in recent_trailers %}
        <div class="upload-item">
            <div>
                <strong>Video {{ trailer.video_number }}</strong>: {{ trailer.media.title }}
                <br>
                <small>{{ trailer.creators }} • {{ trailer.price }} • {{ trailer.length }}</small>
            </div>
            <div>
                <span class="status-badge status-{{ trailer.upload_status|lower }}">{{ trailer.upload_status }}</span>
                <br>
                <small>{{ trailer.created_at|timesince }} ago</small>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No trailers uploaded yet.</p>
    {% endif %}
</div>

<div class="submit-row">
    <a href="{% url 'admin:trailers_trailermeta_changelist' %}" class="button">View All Trailers</a>
    <a href="{% url 'admin:trailers_trailermeta_add' %}" class="button default">Add New Trailer</a>
    <a href="{% url 'admin:trailers_bulk_upload' %}" class="button">Bulk Upload</a>
</div>
{% endblock %}